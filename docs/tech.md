# Техническая документация

Программа использует event-driven архитектуру. При запуске приложения публикуется событие `AppStarted`. На событие реагируют два обработчика:

- `BackupHandler`, который создает первоначальные данные в `MongoDB` при первом запуске и осуществляет их бекап при последующих
- `DataHandler` отслеживает появление новых данных на `MOEX ISS`. В случае необходимости публикует событие `NewDataPublished` с информацией о последнем торговом дне, которое запускает цикл обновления данных (синий на схеме). Если новых данных нет, то обработчик проверяет не изменился ли состав портфеля в результате действий пользователя и публикует событие `DataChecked` с информацией о последнем торговом дне и версии портфеля, которое запускает цикл тренировки моделей и обновления прогнозов (зеленый на схеме). Оба цикла завершаются отправкой сообщений для обработчика `DataHandler` в результате процесс продолжается бесконечно - или обновляются данные, или тренируются новые модели и обновляются прогнозы

![Схема событий](.excalidraw.svg)
